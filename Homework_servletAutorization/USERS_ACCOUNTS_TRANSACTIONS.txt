CREATE DATABASE bank;
-------------------------------------
CREATE TABLE customers(
	
id BIGSERIAL PRIMARY KEY,

firstname VARCHAR(50) NOT NULL,

lastname VARCHAR(50) NOT NULL,

birthdate DATE NOT NULL,

address VARCHAR(45) NOT NULL,

city VARCHAR(45) NOT NULL,

passport VARCHAR(8) NOT NULL UNIQUE,

phone VARCHAR(14) NOT NULL
);

CREATE TABLE accounts ( 
	
accountnumber BIGSERIAL PRIMARY KEY,
	
balance DECIMAL DEFAULT 0,
	
creationdate TIMESTAMP NOT NULL,
	
currency VARCHAR(3) NOT NULL DEFAULT 'UAH',
	
blocked BOOLEAN DEFAULT false,
	
customerid BIGINT
);

ALTER TABLE accounts
    ADD CONSTRAINT fk_accounts_customers_customerid_id
    FOREIGN KEY (customerid)
    REFERENCES customers (id);


CREATE TABLE transactions (
	
id BIGSERIAL PRIMARY KEY,

amount DECIMAL NOT NULL,
	
date TIMESTAMP NOT NULL,

operationtype VARCHAR(3) NOT NULL,
	
accountnumber BIGINT
);

ALTER TABLE transactions
    ADD CONSTRAINT fk_transactions_accounts_accountnumber_accountnumber
    FOREIGN KEY (accountnumber)
    REFERENCES accounts (accountnumber);


CREATE TABLE users ( 
	
userid BIGSERIAL PRIMARY KEY,
	
login VARCHAR(20) NOT NULL UNIQUE,
	
password VARCHAR(20) NOT NULL,
	
name VARCHAR(20) NOT NULL,
	
role VARCHAR(5) NOT NULL DEFAULT 'User',
	
customerid BIGINT
);

ALTER TABLE customers
    ADD CONSTRAINT fk_customers_users_id_customerid
    FOREIGN KEY (id)
    REFERENCES users (customerid);

CREATE TABLE avatars (

avatarid BIGSERIAL PRIMARY KEY,

filename VARCHAR(20)NOT NULL,

imagedata bytea NOT NULL,

userid BIGINT
);

ALTER TABLE users
    ADD CONSTRAINT fk_users_avatars_userid_userid
    FOREIGN KEY (userid)
    REFERENCES avatars (userid);
